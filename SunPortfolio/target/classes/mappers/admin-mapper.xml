<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
	<select id="selectMember" resultType="sun.spring.dto.AdminDTO">
		select seq, id, pw from adminmember where id=#{id} and pw=#{pw}
	</select>

	<insert id="insertAdminIpCk">
		insert into ipCk (seq, ip, visitDate) values(ipCkSeq.nextval, #{ip}, sysdate)
	</insert>

	<update id="updateAdminIpCk">
		update ipCk set visitcnt = (visitcnt+1)	where ip=#{ip} and to_date(sysdate,'YY/MM/DD')= visitdate
	</update>

	<select id="selectIpExistCk" resultType="int">
		select count(*) from ipCk where ip=#{ip} and to_date(sysdate,'YY/MM/DD') = visitdate
	</select>

	<select id="selectTodayTotalCut" resultType="int">
		select count(*) from ipCk where to_date(sysdate,'YY/MM/DD') = visitdate
	</select>

	<select id="selectYesterDayTotalCut" resultType="Integer">
		select * from ipCk where to_date(sysdate-1,'YY/MM/DD') = visitdate
	</select>

	<select id="selectTotalV" resultType="int">
		select count(1) from ipCk
	</select>

	<select id="conview" resultType="sun.spring.dto.ContactDTO">
		select * from sunportfolio where seq = ${seq}
	</select>

	<update id="receiptUpdate">
		update sunportfolio set category = #{category}, title = #{title}, company = #{company}, grade = #{grade}, name = #{name}, tel = #{tel}, content = #{content} where seq = ${seq}
	</update>

	<!-- comment -->
	<insert id="commentInsert">
		insert into sun_comment values (sun_commentSeq.nextval, #{sunportfolioSeq}, #{name}, #{commentText}, sysdate)
	</insert>

	<!-- comment 조회 -->
	<select id="commentSelect" resultType="sun.spring.dto.CommentDTO">
		select * from sun_comment where sunportfolioSeq = ${sunportfolioSeq}
	</select>

	<delete id="commentDelete">
		delete from sun_comment where seq = ${seq} and sunportfolioSeq = ${sunportfolioSeq}
	</delete>
	
	<update id="commentUpdate">
		update sun_comment set commentText = #{commentText} where seq = ${seq} and sunportfolioSeq = ${sunportfolioSeq}
	</update>

	<select id="boardCount10" parameterType="hashMap" resultType="sun.spring.dto.ContactDTO">
		select * from ( select rownum as rnum, sun.* from( select seq, title, name, content, contact, con_date from sunportfolio where contact=#{contact} order by con_date desc) sun) where rnum between ${start} and ${end}
	</select>

	<update id="contactChange">
		update sunportfolio set contact = #{contact} where seq = #{seq}
	</update>

	<!-- 공통코드 불러오기 :: 카테고리 메뉴 -->
	<select id="codeGroupSelect" resultType="sun.spring.dto.CodeGroup">
		SELECT * FROM common_code WHERE CMNS_CD_GROUP_ID = #{cmns_cd_group_id}  AND UP_CMNS_CD IS null
	</select>

	<!-- 공통코드 불러오기 :: 카테고리 상세 메뉴 -->
	<select id="codeSelect" resultType="sun.spring.dto.CodeGroup">
		SELECT * FROM common_code WHERE CMNS_CD_GROUP_ID = #{cmns_cd_group_id} AND UP_CMNS_CD IS NOT NULL AND UP_CMNS_CD = #{cmns_cd}
	</select>

	<!-- 공통코드 불러오기 :: 각 컨텐츠 별 선택 메뉴 불러오기  -->
	<select id="getChooseMenu" resultType="sun.spring.dto.CodeGroup">
		SELECT
			t2.SEQ,
			t2.CATEGPRYMENUSEQ,
			t2.CMNS_CD_GROUP_ID,
			t2.CMNS_CD,
			t2.CMNS_CD_NM,
			t2.UP_CMNS_CD_GROUP_ID,
			t2.UP_CMNS_CD
		FROM
			SUNPORTFOLIO t1
				INNER JOIN categoryMenu t2
				ON	t1.seq = t2.seq
		WHERE
			t1.seq = #{seq}
	</select>

	<delete id="deleteChooseMenu">
		delete from categoryMenu where seq = ${seq} and categprymenuseq = ${categprymenuseq}
	</delete>

	<delete id="deleteAllMenu">
		delete from categoryMenu where seq = ${seq}
	</delete>

	<!-- CATEGORYMENU insert를 하기 위한 sql -->
	<select id="insertWithCodeSelect" resultType="sun.spring.dto.CodeGroup">
		SELECT * FROM common_code WHERE CMNS_CD = #{cmns_cd}
	</select>

	<insert id="insertChooseMenu">
		INSERT
		INTO
			KH.CATEGORYMENU
		(
			CATEGPRYMENUSEQ,
			SEQ,
			CMNS_CD_GROUP_ID,
			CMNS_CD,
			CMNS_CD_NM,
			FRST_REG_DT,
			FRST_RGTR_ID,
			LAST_MDFCN_DT,
			LAST_MDFR_ID,
			UP_CMNS_CD_GROUP_ID,
			UP_CMNS_CD
		)VALUES(
			  categoryMenu_seq.nextval,
			  #{seq},
			  #{cmns_cd_group_id},
			  #{cmns_cd},
			  #{cmns_cd_nm},
			  CURRENT_TIMESTAMP,
			  #{last_mdfr_id},
			  CURRENT_TIMESTAMP,
			  #{last_mdfr_id},
			  #{up_cmns_cd_group_id},
			  #{up_cmns_cd}
		)
	</insert>

</mapper>
